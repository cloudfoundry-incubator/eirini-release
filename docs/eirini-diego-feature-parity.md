# Eirini - Diego feature parity

| Feature                                      | Description                                                                                                                  | Link                                                                             | CATs | Diego | Eirini | Notes                                                                                                     |
| -------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- | :--: | :---: | :----: | --------------------------------------------------------------------------------------------------------- |
| tcp routing                                  | Allows TCP connections to apps                                                                                               |                                                                                  |  ✓   |   ✓   |   ✗    |                                                                                                           |
| CPU throttling                               | Throttle cpu of badly behaving apps                                                                                          | https://www.cloudfoundry.org/blog/better-way-split-cake-cpu-entitlements/        |  ✓   |   ✓   |   ✗    |                                                                                                           |
| cf push (with docker image) / USER as string | Garden automatically maps the user to a user ID                                                                              |                                                                                  |  ✗   |   ✓   |   ✗    |                                                                                                           |
| isolation segments                           | Isolation segments provide dedicated pools of resources where you can deploy apps and isolate workloads.                     | https://docs.cloudfoundry.org/adminguide/isolation-segments.html                 |  ✓   |   ✓   |   ✗    |                                                                                                           |
| docker private registry push                 | Deploy docker images from private registries                                                                                 | https://docs.cloudfoundry.org/devguide/deploy-apps/push-docker.html#private-repo |  ✓   |   ✓   |   ✓    | This is excluded in kubecf CATs, but should work once tasks are updated to latest eirini functionality    |
| route services                               |                                                                                                                              | https://docs.cloudfoundry.org/services/route-services.html                       |  ✓   |   ✓   |   ✗    | Does not work in kubecf but maybe that's a setup issue in kubecf (e.g. route_services_secret missing ?)   |
| ssh                                          | cf ssh into running app instances                                                                                            | https://docs.cloudfoundry.org/devguide/deploy-apps/ssh-apps.html                 |  ✓   |   ✓   |   ✗    | kubecf implements this with [eirinix hook](https://github.com/cloudfoundry-incubator/eirini-ssh)          |
| routing isolation segments                   | Operators can configure and manage routing for isolation segments in Cloud Foundry (CF)                                      | https://docs.cloudfoundry.org/adminguide/routing-is.html                         |  ✓   |   ✓   |   ✗    |                                                                                                           |
| security groups                              | collection of egress rules that specify the protocols, ports, and IP address ranges where app or task instances send traffic | https://docs.cloudfoundry.org/concepts/asg.html                                  |  ✓   |   ✓   |   ✗    | Does not work in kubecf, but we think it's not a responsibility of Eirini                                 |
| tasks                                        | run a one-off task for a running app                                                                                         | https://docs.cloudfoundry.org/devguide/using-tasks.html                          |  ✓   |   ✓   |   ?    | running tasks fail in kubecf v2.6.1, but we think that is because they are using an older Eirini (v1.8.0) |
| windows support                              | run containers on windows nodes                                                                                              |                                                                                  |  ✓   |   ✓   |   ✗    | This is not supported in the whole cf-4-k8s deployment, it's not just an Eirini feature                   |
| sidecars                                     | run additional app processes in an adjacent container                                                                        | https://docs.cloudfoundry.org/devguide/sidecars.html                             |  ✗   |   ✓   |   ✗    |                                                                                                           |
| multi-process apps                           | use a single command to push apps that run multiple processes, such as a web app that has a UI process and a worker process  | https://docs.cloudfoundry.org/devguide/multiple-processes.html                   |  ✗   |   ✓   |   ✗    |                                                                                                           |
| v3                                           | CF v3 API                                                                                                                    | https://docs.cloudfoundry.org/devguide/v3-commands.html                          |  ✓   |   ✓   |   ?    | We think this works but have no way of testing currently                                                  |
| non-numeric "USER" in Docker image | `cf push myapp --docker-image myrepo/myapp:mytag` where the Docker image has USER specified as a string | https://docs.cloudfoundry.org/devguide/deploy-apps/push-docker.html |  ✗  |   ✓   |   ✗   | Kubernetes doesn't support User namespaces (while Docker and Garden do). This means, whatever UID you have in your container is gonna match the user of the same UID on the host. For that reason, Eirini enforces RunAsNonRoot which means, Kubernetes will reject any image that either doesn't specify a USER (since root is the default), or specifies a user as a string (since Kubernetes can't check whether that user is root or not). The workaround is to specify the USER using the numeric UID in the Dockerfile. |
